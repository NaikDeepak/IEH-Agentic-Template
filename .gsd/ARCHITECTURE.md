# Architecture

> Auto-generated by /map on 2026-02-18

## Overview

**IEH** (Insider Edge Hiring) is an AI-powered job marketplace platform connecting job seekers and employers. It features a React 19 SPA frontend, an Express.js backend serving as a BFF (Backend-for-Frontend), Firebase (Auth + Firestore) as the primary data layer, and Google Cloud Functions for async/event-driven workloads. Gemini AI powers resume analysis, skill gap detection, interview prep, job description generation, and semantic candidate search.

```
┌──────────────────────────────────────────────────────────────┐
│                    React 19 SPA (Vite)                       │
│  Seeker Dashboard | Employer Suite | Admin Panel | Landing   │
├──────────────────────────────────────────────────────────────┤
│              Express.js BFF  (src/server/)                   │
│   /api/v1/ai  |  /api/v1/jobs  |  /api/v1/candidates        │
│   /api/v1/user  |  /api/v1/growth                           │
├──────────────────────────────────────────────────────────────┤
│   Firebase Auth    │   Cloud Firestore   │  Cloud Functions  │
│   (JWT + Google)   │   (Primary DB)      │  (Async triggers) │
├──────────────────────────────────────────────────────────────┤
│                  Google Gemini AI                            │
│   gemini-2.0-flash-lite  |  text-embedding-004              │
└──────────────────────────────────────────────────────────────┘
```

---

## User Roles

| Role | Entry Point | Capabilities |
|------|------------|--------------|
| `seeker` | `/seeker/dashboard` | Resume analysis, skill gap, interview prep, job tracking, referrals, networking |
| `employer` | `/employer/jobs` | Post jobs, talent search (semantic), view applicants, company profile |
| `admin` | `/admin` | Platform overview, financial dashboard, user management |

---

## Components

### Frontend — Feature-Sliced Architecture (`src/`)

#### Core
- **`src/App.tsx`** — Root router with lazy-loaded pages, role-based redirects, `ProtectedRoute` guard
- **`src/main.tsx`** — React 19 entry point, Sentry instrumentation
- **`src/context/AuthProvider.tsx`** — Firebase Auth state provider
- **`src/hooks/useAuth.ts`** — Auth context consumer hook
- **`src/lib/firebase.ts`** — Firebase SDK init (emulator-aware via `VITE_USE_FIREBASE_EMULATOR`)

#### Seeker Feature (`src/features/seeker/`)
- **ResumeAnalyzer** — Upload/paste resume → AI analysis via `/api/v1/ai/resume`
- **GapAnalysis** — Skill gap detection against target roles
- **InterviewPrep** — AI-generated interview Q&A
- **SkillProofs** — Skill assessment/verification
- **InsiderConnections** — Networking recommendations
- **ApplicationBoard** — Kanban-style application tracker
- **ProfileEditor** — Seeker profile management
- **ShortlistFeed** — AI-curated job recommendations

#### Growth Feature (`src/features/growth/`)
- **ReferralDashboard** — Referral tracking (data fetched via secure `/api/v1/growth/referrals`)
- **PhoneVerification** — Firebase phone auth (RecaptchaVerifier)
- **LinkedInVerification** — LinkedIn profile verification
- **LedgerService** — Points/rewards ledger (Firestore)

#### Jobs Feature (`src/features/jobs/`)
- **JobService** — CRUD for job postings (Firestore direct)

#### Applications Feature (`src/features/applications/`)
- **ApplicationService** — Application CRUD (Firestore direct)
- **KanbanBoard** — Drag-and-drop applicant pipeline (dnd-kit)

#### Candidates Feature (`src/features/candidates/`)
- **CandidateService** — Candidate profile queries

#### Companies Feature (`src/features/companies/`)
- **CompanyService** — Company profile management

### Backend — Express BFF (`src/server/`)

| Route | Controller | Purpose |
|-------|-----------|---------|
| `POST /api/v1/ai/resume` | `ai.controller.js` | Resume parsing via Gemini |
| `POST /api/v1/ai/embedding` | `ai.controller.js` | Vector embedding generation |
| `POST /api/v1/ai/generate-jd` | `ai.controller.js` | Job description generation |
| `GET /api/v1/jobs/search` | `jobs.controller.js` | Semantic job search |
| `GET /api/v1/candidates/search` | `candidates.controller.js` | Semantic candidate search |
| `GET /api/v1/user/profile` | `user.controller.js` | User profile (admin-SDK read) |
| `GET /api/v1/growth/referrals` | `growth.controller.js` | Secure referral data |

**Middleware stack:** CORS → JSON body → `authMiddleware` (Firebase ID token verify) → routes → `errorHandler`

### Cloud Functions (`functions/src/`)

| Function | Trigger | Purpose |
|----------|---------|---------|
| `onApplicationCreate` | Firestore onCreate | Notify employer on new application |
| `growth/referral.js` | HTTP | Referral tracking logic |
| `ai/handlers/` | HTTP | AI proxy (assessment, interview, networking, resume, skills) |
| `marketProxy.js` | HTTP | Market trends proxy |

---

## Data Flow

### Seeker Resume Analysis
1. Seeker uploads/pastes resume in `ResumeAnalyzer`
2. Frontend calls `POST /api/v1/ai/resume` with Firebase ID token
3. `authMiddleware` verifies token via Firebase Admin SDK
4. `ai.service.js` calls Gemini API (`gemini-2.0-flash-lite`)
5. `resumeMapper.ts` parses structured response
6. Result rendered in `AnalysisDisplay`

### Semantic Candidate Search (Employer)
1. Employer enters search query in `TalentSearch`
2. Frontend calls `POST /api/v1/candidates/search`
3. Backend generates query embedding via `text-embedding-004`
4. Vector similarity search against Firestore candidate profiles
5. Results ranked and returned

### Authentication Flow
1. User registers/logs in via Firebase Auth (email+password or Google)
2. `AuthProvider` subscribes to `onAuthStateChanged`
3. Custom claims set via Cloud Function on role selection
4. `ProtectedRoute` checks `userData.role` from Firestore `users/{uid}`
5. JWT ID token attached to all API requests via `authMiddleware`

---

## Integration Points

| Service | Type | Purpose |
|---------|------|---------|
| Firebase Auth | Auth | User authentication, JWT tokens, phone verification |
| Cloud Firestore | Database | All persistent data (users, jobs, applications, companies, referrals) |
| Google Cloud Functions | Serverless | Async triggers, secure AI proxy endpoints |
| Google Gemini API | AI/ML | Resume analysis, JD generation, interview prep, skill assessment |
| Gemini Embeddings | Vector | Semantic search for jobs and candidates |
| Sentry | Monitoring | Error tracking + performance (client + server) |
| Vercel | Hosting | Frontend deployment (`.vercel/` config present) |

---

## Technical Debt

- [ ] **Admin Users Management** — `/admin/users` is a placeholder (`"Users Management (Placeholder)"`)
- [ ] **Admin Settings** — `/admin/settings` is a placeholder
- [ ] **Mixed JS/TS** — Server code (`src/server/`) is `.js`, frontend is `.tsx`/`.ts`
- [ ] **Dual server architecture** — Express BFF + Cloud Functions creates duplication (e.g., AI handlers exist in both `functions/src/ai/` and `src/server/features/ai/`)
- [ ] **Legacy route aliases** — `/api/embedding` and `/api/generate-jd` compatibility shims still present
- [ ] **`generation.js` duplication** — `src/lib/ai/generation.js` and `functions/lib/ai/generation.js` appear duplicated
- [ ] **`seed-jobs.js` in root** — Seed script at project root, not in `scripts/`
- [ ] **`inspect-exports.js` / `test-import.js`** — Debug scripts committed to root

---

## Conventions

**Naming:**
- Components: PascalCase (`.tsx`)
- Services: PascalCase class with static methods (e.g., `ApplicationService.updateApplicationStatus()`)
- Hooks: camelCase with `use` prefix
- Server files: camelCase (`.js`)

**Structure:** Feature-sliced — each feature owns its `components/`, `services/`, `types.ts`

**Testing:**
- Unit/Integration: Vitest + Testing Library (`tests/` directory mirrors `src/`)
- E2E: Playwright (`e2e/`)
- Setup: `tests/setup.ts` with Firebase mock configuration

**Error Handling:** Sentry `captureException` in catch blocks; `errorHandler` middleware on Express

**Auth:** All protected API calls require `Authorization: Bearer <Firebase ID Token>`
