---
phase: 02-marketplace-mechanics
plan: 06
type: gap_closure
wave: 1
depends_on: [02-05]
files_modified: [src/features/jobs/types.ts, src/features/jobs/services/jobService.ts, firestore.rules]
autonomous: true
must_haves:
  truths:
    - "Job status uses lowercase enum (active/passive) consistently"
    - "Jobs store contactEmail for notifications"
  artifacts:
    - path: "src/features/jobs/services/jobService.ts"
      provides: "JobService with correct enum casing and email handling"
---

<objective>
Fix critical integration gaps in the "Active System" mechanics.

1.  **Status Mismatch**: Standardize Job Status to lowercase ('active', 'passive') to match Firestore Rules and Cloud Functions.
2.  **Missing Email**: Add `contactEmail` to Job documents so the Reaper can send expiration warnings.
</objective>

<execution_context>
@/Users/deepaknaik/.claude/get-shit-done/workflows/execute-plan.md
@/Users/deepaknaik/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02-marketplace-mechanics/02-VERIFICATION.md
@src/features/jobs/types.ts
@src/features/jobs/services/jobService.ts
@firestore.rules
</context>

<tasks>

<task type="auto">
  <name>Task 1: Standardize Job Status Enum</name>
  <files>src/features/jobs/types.ts</files>
  <action>
    Update `JobStatus` type definition to use lowercase values:
    - Change `'ACTIVE' | 'PASSIVE' | 'CLOSED'` to `'active' | 'passive' | 'closed'`.

    Add `contactEmail` to `JobPosting` and `CreateJobInput` interfaces:
    - `contactEmail: string;`
  </action>
  <verify>
    grep "active" src/features/jobs/types.ts
    grep "contactEmail" src/features/jobs/types.ts
  </verify>
  <done>
    Types updated.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Job Service</name>
  <files>src/features/jobs/services/jobService.ts</files>
  <action>
    Update `JobService` implementation:
    1. Update `createJob` to accept `contactEmail` from input and save it to Firestore.
    2. Change hardcoded status `'ACTIVE'` to `'active'`.
    3. Update `getJobs` query to look for `['active', 'passive']` instead of uppercase.
  </action>
  <verify>
    grep "active" src/features/jobs/services/jobService.ts
    grep "contactEmail" src/features/jobs/services/jobService.ts
  </verify>
  <done>
    JobService updated to match Rules and Functions.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update Firestore Rules</name>
  <files>firestore.rules</files>
  <action>
    Update `firestore.rules` for the `jobs` collection:
    1. Allow `contactEmail` in the `allow create` keys list.
    2. Allow `contactEmail` in the `allow update` keys list (optional, but good for consistency).
    3. Ensure status validation checks for `['active', 'passive', 'closed']` (already seems correct in update, verify create/general).
  </action>
  <verify>
    grep "contactEmail" firestore.rules
  </verify>
  <done>
    Rules allow new field.
  </done>
</task>

</tasks>

<verification>
Manual verification via `grep` to ensure no Uppercase statuses remain in relevant files.
</verification>

<success_criteria>
- [ ] JobStatus type is lowercase
- [ ] JobService writes lowercase 'active'
- [ ] JobService reads lowercase 'active'/'passive'
- [ ] Job document includes contactEmail
- [ ] Firestore Rules allow contactEmail
</success_criteria>

<output>
After completion, create `.planning/phases/02-marketplace-mechanics/02-06-SUMMARY.md`
</output>
