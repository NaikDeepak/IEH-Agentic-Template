---
phase: 02-marketplace-mechanics
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - src/features/jobs/services/jobService.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Newly created jobs automatically expire after 4 days if no activity"
    - "New jobs appear in search results sorted by activity"
  artifacts:
    - path: "src/features/jobs/services/jobService.ts"
      provides: "Job creation with expiration timestamps"
      contains: "expiresAt"
  key_links:
    - from: "src/features/jobs/services/jobService.ts"
      to: "firestore.jobs"
      via: "addDoc"
      pattern: "expiresAt.*Timestamp"
---

<objective>
Fix the "zombie job" issue where new jobs are created without expiration timestamps.

Purpose: Ensure the "Active System" logic (Phase 02 core value) works for new jobs, not just updated ones. Without this, new jobs never expire because the reaper query `expiresAt < now` filters out documents missing the field.
Output: Updated `jobService.ts` that initializes `expiresAt` and `lastActiveAt` on creation.
</objective>

<execution_context>
@/Users/deepaknaik/.claude/get-shit-done/workflows/execute-plan.md
@/Users/deepaknaik/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02-marketplace-mechanics/02-VERIFICATION.md
@src/features/jobs/services/jobService.ts

The gap verification identified that `createJob` initializes `status: 'active'` but fails to set the critical `expiresAt` and `lastActiveAt` fields.
</context>

<tasks>

<task type="auto">
  <name>Initialize activity timestamps in createJob</name>
  <files>src/features/jobs/services/jobService.ts</files>
  <action>
    Modify `createJob` in `jobService.ts`:
    1. Import `Timestamp` from `firebase/firestore`.
    2. Calculate `expirationDate` as current time + 4 days (96 hours).
    3. Add `expiresAt` (Timestamp) and `lastActiveAt` (serverTimestamp) to the `jobData` object before `addDoc`.

    Ensure `lastActiveAt` matches the sorting logic used in `getJobs`.
  </action>
  <verify>
    grep -E "expiresAt|lastActiveAt" src/features/jobs/services/jobService.ts
  </verify>
  <done>
    `createJob` payload includes `expiresAt` set to 4 days in future and `lastActiveAt` set to now.
  </done>
</task>

</tasks>

<verification>
Review `src/features/jobs/services/jobService.ts` to confirm:
1. `expiresAt` is calculated correctly (4 days from now).
2. `lastActiveAt` is set using `serverTimestamp()`.
3. Both fields are included in the `addDoc` payload.
</verification>

<success_criteria>
- [ ] `createJob` sets `expiresAt` to 4 days in the future
- [ ] `createJob` sets `lastActiveAt` to current time
- [ ] Gap identified in 02-VERIFICATION.md is closed
</success_criteria>

<output>
After completion, create `.planning/phases/02-marketplace-mechanics/02-08-SUMMARY.md`
</output>
