---
phase: 02-marketplace-mechanics
plan: 03
type: execute
wave: 3
depends_on: [02-02]
files_modified: [functions/index.js, functions/package.json]
autonomous: true
user_setup:
  - service: gmail
    why: "Sending expiration warnings (MVP)"
    env_vars:
      - name: EMAIL_USER
        source: "Gmail Account"
      - name: EMAIL_PASS
        source: "Gmail App Password"
must_haves:
  truths:
    - "Users receive email 24h before expiration"
  artifacts:
    - path: "functions/index.js"
      provides: "Email sending logic"
---

<objective>
Implement expiration warning notifications.

Purpose: Notify users before they lose visibility, prompting engagement.
Output: Updated Reaper function with email capabilities.
</objective>

<execution_context>
@/Users/deepaknaik/.claude/get-shit-done/workflows/execute-plan.md
@/Users/deepaknaik/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-marketplace-mechanics/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Nodemailer</name>
  <files>functions/package.json</files>
  <action>
    Install `nodemailer` in the functions directory.
    `npm install nodemailer --prefix functions`
  </action>
  <verify>
    grep "nodemailer" functions/package.json
  </verify>
  <done>
    Package installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Warning Logic</name>
  <files>functions/index.js</files>
  <action>
    Extend the `reaper` function (or create a separate `notifier` function).

    Logic:
    1. Query the `jobs` collection where `status == 'active'` AND `expiresAt` is between 24h and 48h from now.
    2. Query the `users` collection where `status == 'active'` AND `expiresAt` is between 24h and 48h from now.
    3. For each item found in both queries, send an email using `nodemailer`.
    4. Use a simple HTML template: "Your [Job/Profile] will expire in 24 hours. Login now to keep it active."

    Configure `nodemailer` transporter using process.env variables.
  </action>
  <verify>
    grep "createTransport" functions/index.js
  </verify>
  <done>
    Email logic integrated into scheduled task.
  </done>
</task>

</tasks>

<verification>
Code inspection.
</verification>

<success_criteria>
- [ ] Nodemailer installed
- [ ] Warning query targets both jobs and users within 24-48h window
- [ ] Email sending logic implemented
</success_criteria>

<output>
After completion, create `.planning/phases/02-marketplace-mechanics/02-03-SUMMARY.md`
</output>
