---
phase: 02-marketplace-mechanics
plan: 04
type: execute
wave: 2
depends_on: [02-01]
files_modified: [src/App.tsx, src/features/jobs/services/jobService.ts]
autonomous: true
must_haves:
  truths:
    - "Active jobs appear first in lists"
    - "User login/activity updates their active status"
  artifacts:
    - path: "src/features/jobs/services/jobService.ts"
      provides: "Active-First sorting logic"
---

<objective>
Implement service-layer logic for activity tracking and "Active First" sorting.

Purpose: Enforce the mechanics in the data layer and ensure user actions are tracked.
Output: Updated App.tsx and jobService.ts.
</objective>

<execution_context>
@/Users/deepaknaik/.claude/get-shit-done/workflows/execute-plan.md
@/Users/deepaknaik/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-marketplace-mechanics/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate Activity Tracking Hook</name>
  <files>src/App.tsx</files>
  <action>
    Import `useActivityTracker` (or the function from Plan 01).
    Call `trackUserActivity` on app mount (in `App.tsx` or `AuthProvider`) if user is logged in.
  </action>
  <verify>
    grep "trackUserActivity" src/App.tsx
  </verify>
  <done>
    Login activity is tracked.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Active-First Sorting</name>
  <files>src/features/jobs/services/jobService.ts</files>
  <action>
    Update `fetchJobs` (or equivalent query function) in `jobService.ts`.
    Modify the Firestore query or client-side sort to prioritize:
    1. `status` == 'active' (or sort by status desc if active > passive alphabetically, else custom sort).
    2. `lastActiveAt` (descending).
    
    Ensure passive jobs are still accessible but ranked lower.
  </action>
  <verify>
    Check for sorting logic in jobService.ts
  </verify>
  <done>
    Jobs are sorted active-first.
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire Job Activity Tracking</name>
  <files>src/features/jobs/services/jobService.ts</files>
  <action>
    Identify where a job is "viewed" or "managed" by the recruiter (e.g., `getJobById` or a specific "dashboard view" action).
    Inject `trackJobActivity(jobId)` into this flow to ensure recruiter engagement keeps the job active.
  </action>
  <verify>
    grep "trackJobActivity" src/features/jobs/services/jobService.ts
  </verify>
  <done>
    Recruiter actions keep jobs active.
  </done>
</task>

</tasks>

<verification>
Code inspection of sorting and tracking logic.
</verification>

<success_criteria>
- [ ] trackUserActivity called in App root
- [ ] Job service returns active jobs first
- [ ] Recruiter viewing a job triggers activity update
</success_criteria>

<output>
After completion, create `.planning/phases/02-marketplace-mechanics/02-04-SUMMARY.md`
</output>
