---
phase: 03-semantic-matching
plan: 05
type: execute
wave: 1
depends_on: []
files_modified: [firestore.indexes.json, functions/index.js, src/server/features/candidates/candidates.service.js]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Candidate search does not return 500 'Missing vector index' error"
    - "Candidate search results include the 'status' field"
    - "firestore.indexes.json is valid JSON"
  artifacts:
    - path: "firestore.indexes.json"
      provides: "Valid composite vector indexes"
    - path: "src/server/features/candidates/candidates.service.js"
      provides: "Candidate search with status in response"
---

<objective>
Fix the vector search infrastructure and data whitelisting gaps discovered in UAT.
Purpose: Restore talent search functionality (UAT 5, 7) and provide necessary status data (UAT 8).
</objective>

<execution_context>
@/Users/deepaknaik/.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/03-semantic-matching/03-UAT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Firestore Indexes Syntax and Order</name>
  <files>firestore.indexes.json</files>
  <action>
    - Remove the trailing comma at line 62 of firestore.indexes.json.
    - Reorder the fields in the 'users' collection index (lines 86-106) to put 'status' before 'role' to match the query construction in candidates.service.js and functions/index.js.
  </action>
  <verify>Run `jsonlint` or similar on the file, or check with a JSON validator.</verify>
  <done>File is valid JSON and users index field order is status -> role -> embedding.</done>
</task>

<task type="auto">
  <name>Task 2: Add Status to Candidate Whitelists</name>
  <files>functions/index.js, src/server/features/candidates/candidates.service.js</files>
  <action>
    - In `functions/index.js`, update `searchCandidatesHandler` (around line 397) to include `status` in the destructured object and the returned candidate object.
    - In `src/server/features/candidates/candidates.service.js`, update `searchCandidates` (around line 21) to include `status` in the destructured object and the returned candidate object.
  </action>
  <verify>Grep for 'status' in the whitelists of both files.</verify>
  <done>Both whitelists now include the 'status' field.</done>
</task>

</tasks>

<verification>
Check for 500 errors in browser console during talent search. Verify candidate objects in network response contain 'status: "active"'.
</verification>

<success_criteria>
Candidate search returns results without index errors and includes status data.
</success_criteria>

<output>
After completion, create `.planning/phases/03-semantic-matching/03-05-SUMMARY.md`
</output>
