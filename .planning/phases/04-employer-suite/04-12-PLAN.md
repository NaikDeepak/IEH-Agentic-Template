---
phase: 04-employer-suite
plan: 12
type: execute
wave: 1
depends_on: []
files_modified: [firestore.rules]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Employer can update application status via Kanban board"
    - "Seeker can create applications with all required fields (answers, match_score, etc.)"
  artifacts:
    - path: "firestore.rules"
      provides: "Security rules for applications collection"
  key_links:
    - from: "src/features/applications/services/applicationService.ts"
      to: "Firestore applications collection"
      via: "updateDoc and addDoc"
---

<objective>
Fix Firestore permission errors that prevent employers from updating application statuses on the Kanban board and ensure seeker applications can be correctly created.

Purpose: Restore functionality to the ATS Pipeline and prevent upcoming submission errors.
Output: Updated firestore.rules with correct permissions.
</objective>

<execution_context>
@/Users/deepaknaik/.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/04-employer-suite/04-UAT.md
@firestore.rules
@src/features/applications/services/applicationService.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Firestore Rules for Applications</name>
  <files>firestore.rules</files>
  <action>
    Modify the `match /applications/{appId}` block in `firestore.rules`:
    1. Update the `allow create` rule to include all fields sent by `ApplicationService.submitApplication` (employer_id, answers, match_score, applied_at, updated_at).
    2. Add an `allow update` rule that permits the employer associated with the job to update the 'status' and 'updated_at' fields.
    3. Ensure field immutability for sensitive fields like 'candidate_id' and 'job_id'.
  </action>
  <verify>
    Check that the rules contain:
    - `allow update: if request.auth != null && get(/databases/$(database)/documents/jobs/$(resource.data.job_id)).data.employer_id == request.auth.uid`
    - `request.resource.data.diff(resource.data).changedKeys().hasOnly(['status', 'updated_at'])`
  </verify>
  <done>
    Security rules allow employers to manage application statuses and seekers to apply.
  </done>
</task>

</tasks>

<verification>
Manual verification required:
1. Log in as an employer.
2. Navigate to a job's Applicant Pipeline.
3. Drag an applicant card to a different status.
4. Verify no permission error occurs and the card stays in the new column.
</verification>

<success_criteria>
Kanban status updates persist in Firestore without permission errors.
</success_criteria>

<output>
After completion, create `.planning/phases/04-employer-suite/04-12-SUMMARY.md`
</output>
