---
phase: 04-employer-suite
plan: 06
type: execute
wave: 3
depends_on: ["04-02"]
files_modified: [src/server/features/ai/ai.routes.js, src/server/features/ai/ai.controller.js, src/server/features/ai/ai.service.js, src/pages/PostJob.tsx, src/server/routes.js]
autonomous: true
gap_closure: true
must_haves:
  truths:
    - "AI Screening Questions can be generated from the JD"
    - "JD can be generated with just a job title"
    - "The job posting flow follows a logical sequence"
    - "API routes for AI are consistent and reliable"
  artifacts:
    - path: "src/server/features/ai/ai.service.js"
      provides: "AI assistance for jobs"
    - path: "src/pages/PostJob.tsx"
      provides: "Optimized employer posting UX"
  key_links:
    - from: "src/pages/PostJob.tsx"
      to: "/api/ai/generate-job-assist"
      via: "fetch"
---

<objective>
Fix the broken AI assistance routes and optimize the job posting user experience to address UAT feedback. This plan focuses on backend completion and frontend flow refinement, ensuring all AI-related routes are standardized.
</objective>

<execution_context>
@/Users/deepaknaik/.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/04-employer-suite/04-UAT.md
@src/pages/PostJob.tsx
@src/server/features/ai/ai.service.js
@src/server/routes.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement AI Job Assistance Backend</name>
  <files>src/server/features/ai/ai.service.js, src/server/features/ai/ai.controller.js, src/server/features/ai/ai.routes.js</files>
  <action>
    - Add `generateJobAssist` to `ai.service.js` that takes a JD and returns { questions: ScreeningQuestion[], suggestions: string[] }.
    - Use Gemini to extract 3-5 relevant screening questions and 3 optimization suggestions.
    - Add `generateJobAssist` controller method to `ai.controller.js`.
    - Register `POST /generate-job-assist` route in `ai.routes.js`.
    - Update `generateJD` in `ai.service.js` to handle cases where skills are not provided (AI should suggest them in the JD).
    - Ensure `generateJD` doesn't strictly require `experience` if missing (default to "relevant experience").
  </action>
  <verify>curl -X POST http://localhost:8001/api/ai/generate-job-assist -H "Content-Type: application/json" -d '{"jd": "Sample JD text"}'</verify>
  <done>Backend endpoint for job assistance returns valid JSON with questions and suggestions.</done>
</task>

<task type="auto">
  <name>Task 2: Standardize API Routes</name>
  <files>src/server/routes.js, src/features/jobs/services/jobService.ts</files>
  <action>
    - Clean up `src/server/routes.js` to avoid ambiguous root mounts.
    - Explicitly mount `/embedding` and `/ai` routes.
    - Update `src/features/jobs/services/jobService.ts` to use `/api/ai/embedding` for consistency if needed, or ensure the server route matches the client call exactly.
    - Add logs to `errorHandler.js` if it isn't already logging 404s/500s to help diagnose any lingering issues.
  </action>
  <verify>Check both /api/embedding and /api/ai/embedding using curl.</verify>
  <done>All AI and embedding endpoints are reachable and consistent.</done>
</task>

<task type="auto">
  <name>Task 3: Refine PostJob UX and Flow</name>
  <files>src/pages/PostJob.tsx</files>
  <action>
    - Remove the hard requirement for `skills` in `handleAiGenerateJd`. If missing, tell AI to "include relevant modern skills for this role".
    - Reorganize fields: Title -> AI Generate JD (optional) -> Skills (optional, pre-filled if AI gen) -> AI Suggest Questions (enabled after JD).
    - Improve error handling in the UI to show specific messages for 404 or 500 errors.
    - Add a "Staff Engineer" perspective to the layout: prioritize efficiency, clear labels, and meaningful defaults.
  </action>
  <verify>Visual inspection of PostJob.tsx and manual test of "AI Generate" with only a title.</verify>
  <done>Job posting flow is smoother and no longer fails on missing screening question route.</done>
</task>

</tasks>

<verification>
Verify that clicking "AI Suggest Questions" no longer returns a 404 and successfully populates the screening questions. Verify job creation no longer fails with a 404 for embeddings.
</verification>

<success_criteria>
- AI assistance endpoint is fully functional.
- Employers can generate a JD with just a job title.
- Screening questions are generated successfully from the description.
- Job creation succeeds with embedding generation.
</success_criteria>

<output>
After completion, create `.planning/phases/04-employer-suite/04-06-SUMMARY.md`
</output>
