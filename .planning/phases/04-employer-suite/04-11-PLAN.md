---
phase: 04-employer-suite
plan: 11
type: execute
wave: 1
depends_on: ["04-10"]
files_modified: [firestore.indexes.json, src/features/jobs/types.ts, src/pages/PostJob.tsx, src/features/jobs/services/jobService.ts]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Employer can access their jobs dashboard without DATABASE_ERROR"
    - "Job posting form pre-fills company bio from employer profile"
  artifacts:
    - path: "firestore.indexes.json"
      provides: "Composite index for employer jobs query"
    - path: "src/pages/PostJob.tsx"
      provides: "Pre-filled company data in form"
  key_links:
    - from: "src/pages/PostJob.tsx"
      to: "CompanyService.getCompanyByEmployerId"
      via: "useEffect hook"
---

<objective>
Resolve the critical [DATABASE_ERROR] preventing employers from seeing their jobs and improve the UX by pre-filling company details in the posting flow.
</objective>

<execution_context>
@/Users/deepaknaik/.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/04-employer-suite/04-UAT.md
@src/features/jobs/services/jobService.ts
@src/pages/PostJob.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Missing Firestore Index</name>
  <files>firestore.indexes.json</files>
  <action>
    Add a composite index for the 'jobs' collection to support the dashboard query.
    Fields:
    - employer_id (ASCENDING)
    - created_at (DESCENDING)

    This matches the query in JobService.getJobsByEmployerId which currently fails with a 400 (FAILED_PRECONDITION) because of the missing index.
  </action>
  <verify>Check firestore.indexes.json for the new entry</verify>
  <done>Index definition exists for employer_id/created_at combination</done>
</task>

<task type="auto">
  <name>Task 2: Implement Company Bio Pre-fill</name>
  <files>src/features/jobs/types.ts, src/pages/PostJob.tsx, src/features/jobs/services/jobService.ts</files>
  <action>
    1. Update JobPosting and CreateJobInput interfaces in src/features/jobs/types.ts to include optional 'company_bio' string field.
    2. Update JobService.createJob in src/features/jobs/services/jobService.ts to persist 'company_bio' to Firestore.
    3. In src/pages/PostJob.tsx:
       - Add 'company_bio' to form state.
       - Use useEffect to call CompanyService.getCompanyByEmployerId(user.uid) on mount.
       - If company found, pre-fill 'company_bio' state with company.bio.
       - Add a textarea for 'About the Company' to the form so the employer can review/edit it before publishing.
  </action>
  <verify>Open /post-job, verify the 'About Company' field is populated with data from the employer's profile.</verify>
  <done>Form successfully pre-fills and persists company bio</done>
</task>

</tasks>

<verification>
1. Employer Dashboard loads jobs without error.
2. Post Job form shows pre-filled company info.
</verification>

<success_criteria>
All Phase 04 UAT gaps diagnosed as blockers or required UX improvements are resolved.
</success_criteria>

<output>
After completion, create .planning/phases/04-employer-suite/04-11-SUMMARY.md
</output>
