# Phase 04 Plan 09: Job Posting Flow Optimization

## Objective
Rearrange the Job Posting UI flow to capture key details (Position, Skills, Location, Type, Mode) *before* generating the Job Description. Update the AI service to utilize these fields for more context-aware generation.

## Gap Diagnosis
- **Issue:** User reported the flow feels "improper" because JD generation happens before context fields (Skills, Location, etc.) are entered.
- **Root Cause:** `PostJob.tsx` layout places JD generation immediately after Title. The AI prompt only uses Title and optional Skills, missing out on Location/Type context.
- **Fix:** Move input fields above the JD editor and pass all available context to the AI.

## Proposed Changes

### 1. Frontend: `src/pages/PostJob.tsx`
- **Layout Reordering:**
  1. **Section 1: The Basics** (Title)
  2. **Section 2: Role Context** (Skills, Location, Type, Mode)
  3. **Action:** "Generate Description with AI" button (prominent, between context and editor)
  4. **Section 3: Description** (JD Editor)
  5. **Section 4: Screening & Contact** (Screening Questions, Salary, Email)
- **Logic Update:**
  - Update `handleAiGenerateJd` to collect `location`, `type`, and `work_mode` from state.
  - Send these fields in the POST request to `/api/ai/generate-jd`.

### 2. Backend: `src/server/features/ai/ai.controller.js`
- Update `generateJD` handler to extract `location`, `type`, `work_mode` from `req.body`.
- Pass these fields to the service.

### 3. Backend: `src/server/features/ai/ai.service.js`
- Update `generateJD` signature to accept `location`, `type`, `work_mode`.
- Enhance the Gemini prompt to incorporate these details (e.g., "The role is based in {location} and is {type} ({work_mode}).").

## Verification Plan
1. **Manual Verification**:
   - Navigate to `/post-job`.
   - Fill Title, Skills, Location, Type, Mode.
   - Click "Generate Description".
   - Verify the generated JD mentions the specific location/mode/skills.
   - Verify the "Missing required fields" error does not occur.

## Notes
- This aligns the UI with the user's mental model: "Define the role first, then let AI write the description."
