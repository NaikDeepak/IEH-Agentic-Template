# Plan: 07-01 — Sentry Enhancement & Structured Logging

## Goal
Upgrade Sentry from basic browser tracing to full observability: structured logging, server-side instrumentation, and span tracing for critical service calls.

## Proposed Changes

### 1. Client-Side: Enable Logging Integration
- Update `src/instrument.ts` to add `enableLogs: true` and `consoleLoggingIntegration`.
- Add `Sentry.logger` calls in critical services: `referralService`, `ledgerService`, `resumeService`.

### 2. Server-Side: Cloud Functions Instrumentation
- Add `@sentry/node` to `functions/package.json`.
- Create `functions/src/instrument.js` with server-side `Sentry.init`.
- Wrap AI proxy handlers and referral handlers with `Sentry.startSpan` for performance tracing.

### 3. Custom Spans for Key Flows
- AI Proxy calls (`callAIProxy` → Cloud Function → Gemini API): measure latency per handler.
- Referral reward trigger: trace from application submit → verification check → ledger write.
- Resume analysis: trace from upload → parse → AI call → persist.

### 4. Error Boundary Enhancement
- Add `Sentry.ErrorBoundary` wrapper around critical route components.
- Ensure all `catch` blocks call `Sentry.captureException(error)`.

## Verification Plan
1. Trigger an error in the referral flow; verify it appears in Sentry dashboard.
2. Verify custom spans appear in Sentry Performance tab.
3. Verify structured logs appear in Sentry Logs tab.
