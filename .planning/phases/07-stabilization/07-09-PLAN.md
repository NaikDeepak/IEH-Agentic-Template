# Plan: 07-09 — Environment & Deployment Hardening

## Goal
Ensure clean separation between dev/staging/production environments, secrets management, and safe production deploys.

## Proposed Changes

### 1. Environment Configuration
- Audit `.env.example` — ensure every required variable is documented with description and example value.
- Create Firebase project aliases: `dev`, `staging`, `production` in `.firebaserc`.
- Ensure `firebase.json` uses the correct hosting/functions config for production.

### 2. Firebase Hosting Configuration
- Add `cleanUrls: true` and SPA rewrite rule (`"source": "**"` → `/index.html`).
- Configure custom cache headers for static assets (`immutable` for hashed files, short TTL for `index.html`).
- Add security headers via `firebase.json` hosting config:
  - `X-Frame-Options: DENY`
  - `X-Content-Type-Options: nosniff`
  - `Referrer-Policy: strict-origin-when-cross-origin`

### 3. Firestore Backups
- Document recommended Firestore automated export schedule using `gcloud firestore export`.
- Create a Cloud Scheduler function or document the `gcloud` command for daily exports to a GCS bucket.

### 4. Staging Environment
- Document how to deploy to staging channel: `firebase hosting:channel:deploy staging`.
- Ensure staging uses a separate Firestore database or namespace to prevent data contamination.

### 5. Production Readiness Checklist
- Create `PRODUCTION_CHECKLIST.md` at project root:
  - [ ] All environment variables set in Firebase Functions config
  - [ ] CORS origins updated to production domain only
  - [ ] Sentry DSN set for both client and server
  - [ ] Firestore security rules deployed
  - [ ] Firebase Hosting CDN headers configured
  - [ ] `NODE_ENV=production` set in functions runtime
  - [ ] Rate limits tuned for expected traffic
  - [ ] Error notification channel configured (Sentry alerts)

## Verification Plan
1. Deploy to a staging channel — app loads correctly with correct environment.
2. Verify production checklist has no unchecked items before first real deploy.
3. Verify `firebase.json` hosting headers with `curl -I`.
