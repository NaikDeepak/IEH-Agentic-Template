# Plan: 07-03 â€” Firestore Security Rules Audit

## Goal
Harden Firestore security rules to enforce deny-by-default, validate all document writes, and prevent unauthorized data access.

## Proposed Changes

### 1. Rules Inventory
- Map every Firestore collection to its required read/write access patterns.
- Document which roles (seeker, employer, admin) can access what.

### 2. Lock Down Rules
- Ensure all collections default to `deny` unless explicitly allowed.
- Validate `referralCodes` collection: only server (Cloud Functions) can write; clients can read by code only.
- Validate `ledger` collection: only server can write; users can read their own entries.
- Validate `applications` collection: seekers can create; employers can read for their jobs; only server can update status.
- Validate user profiles: only the owner can read/write their own document.

### 3. Write Validation Rules
- Add `request.resource.data` validation for critical fields (e.g., `browniePoints` cannot be set directly by client).
- Enforce `request.auth != null` on all non-public paths.

### 4. Security Rules Tests
- Create `tests/firestore-rules.test.ts` using `@firebase/rules-unit-testing`.
- Test: anonymous user cannot read profiles.
- Test: user A cannot read user B's profile.
- Test: client cannot write to `ledger` directly.
- Test: employer can read applications for their jobs only.

## Verification Plan
1. All rules tests pass.
2. Deploy rules to emulator; manually verify access patterns.
3. No regression in existing application functionality.
