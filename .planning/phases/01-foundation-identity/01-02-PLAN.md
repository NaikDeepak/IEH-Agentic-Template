---
phase: 01-foundation-identity
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: [src/types/user.ts, src/components/ProtectedRoute.tsx, src/components/RoleSelection.tsx, src/App.tsx, src/context/AuthProvider.tsx]
autonomous: true
---

<objective>
Implement granular RBAC and protected routes.
Purpose: Requirement AUTH-02 (Granular RBAC) and ensuring secure access control.
Output: UserData type update, ProtectedRoute component, RoleSelection update.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-identity/01-01-SUMMARY.md
@src/context/AuthProvider.tsx
</context>

<tasks>
<task type="auto">
  <name>Task 1: Update UserData Type</name>
  <files>src/types/user.ts (or definition file)</files>
  <action>
    1. Find where `UserData` or user interface is defined (likely global or in AuthContext).
    2. Update `role` field to support: 'seeker' | 'employer' | 'admin'.
    3. Add `employerRole` field (optional): 'owner' | 'recruiter' | 'hiring_manager'.
  </action>
  <verify>grep "employerRole" src/types/user.ts</verify>
  <done>Types updated</done>
</task>

<task type="auto">
  <name>Task 2: Create ProtectedRoute Component</name>
  <files>src/components/ProtectedRoute.tsx</files>
  <action>
    Create a wrapper component that:
    1. Checks `useAuth` for `currentUser` and `loading`.
    2. If loading, show spinner.
    3. If not logged in, redirect to `/login`.
    4. If logged in but `requiredRole` prop is passed and doesn't match, redirect to unauthorized (or home).
    5. Render children if allowed.
  </action>
  <verify>npm run build succeeds</verify>
  <done>ProtectedRoute component created</done>
</task>

<task type="auto">
  <name>Task 3: Update RoleSelection</name>
  <files>src/components/RoleSelection.tsx</files>
  <action>
    Update the role selection flow:
    1. "Candidate" -> sets role: 'seeker'.
    2. "Employer" -> sets role: 'employer', employerRole: 'owner' (default for new signups).
    3. Save to Firestore `users` collection.
  </action>
  <verify>Check file content</verify>
  <done>RoleSelection handles new schema</done>
</task>

<task type="auto">
  <name>Task 4: Secure App Routes</name>
  <files>src/App.tsx</files>
  <action>
    Wrap sensitive routes with ProtectedRoute:
    - /dashboard -> allowed: ['seeker', 'employer', 'admin']
    - /post-job -> allowed: ['employer']
    - /admin/* -> allowed: ['admin']
  </action>
  <verify>npm run build succeeds</verify>
  <done>Routes secured</done>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] ProtectedRoute enforces access logic
</verification>

<success_criteria>
- Types support granular roles
- Routes are protected by role
- New users are correctly assigned default sub-roles
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-identity/01-02-SUMMARY.md`
</output>
